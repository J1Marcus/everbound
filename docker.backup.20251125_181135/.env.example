# ============================================
# Supabase Self-Hosted Environment Configuration
# ============================================
# Copy this file to .env and update with your values
# NEVER commit the actual .env file to version control
#
# For detailed documentation of each variable, see:
# docs/ENVIRONMENT_VARIABLES.md

# ============================================
# PROJECT CONFIGURATION
# ============================================
# CRITICAL: PROJECT_NAME must be unique for each instance to prevent
# container/volume/network conflicts when running multiple instances
# Examples: customer_a_supabase, customer_b_supabase, dev_supabase
PROJECT_NAME=supabase_template

# Environment type: local, staging, or production
ENVIRONMENT=local

# Port offset for running multiple instances on the same server
# Instance 1: PORT_OFFSET=0 (default ports)
# Instance 2: PORT_OFFSET=100 (ports +100)
# Instance 3: PORT_OFFSET=200 (ports +200)
# Leave at 0 if running a single instance
PORT_OFFSET=0

# ============================================
# CALCULATED PORTS (Auto-calculated from PORT_OFFSET)
# ============================================
# These will be calculated by scripts/calculate-ports.sh
# Base ports + PORT_OFFSET
POSTGRES_PORT=5432
KONG_HTTP_PORT=8000
KONG_HTTPS_PORT=8443
STUDIO_PORT=3000
MINIO_PORT=9000
MINIO_CONSOLE_PORT=9001
REDIS_PORT=6379
GOTRUE_PORT=9999
POSTGREST_PORT=3000
REALTIME_PORT=4000
STORAGE_PORT=5000
FUNCTIONS_PORT=9000
META_PORT=8080

# ============================================
# DATABASE CONFIGURATION
# ============================================
# PostgreSQL database credentials
# SECURITY: Use a strong random password (32+ characters)
# Generate with: openssl rand -base64 32
POSTGRES_PASSWORD=<strong-random-password>

# Database name (default: postgres)
POSTGRES_DB=postgres

# Database user (default: postgres)
POSTGRES_USER=postgres

# Database host (internal Docker network)
POSTGRES_HOST=db

# ============================================
# AUTHENTICATION CONFIGURATION (JWT)
# ============================================
# JWT secret for signing tokens (256-bit minimum)
# Generate with: openssl rand -base64 32
# SECURITY: This is critical - keep it secret and never share
JWT_SECRET=<256-bit-secret>

# Anonymous access JWT token (read-only access)
# Generate with scripts/generate-secrets.sh or Supabase CLI
# This token has the 'anon' role
ANON_KEY=<jwt-token-with-anon-role>

# Service role JWT token (full access, bypass RLS)
# Generate with scripts/generate-secrets.sh or Supabase CLI
# This token has the 'service_role' role
# SECURITY: Keep this extremely secure - it bypasses all security
SERVICE_ROLE_KEY=<jwt-token-with-service-role>

# Site URL for authentication redirects
# Local: http://localhost:3000
# Production: https://yourdomain.com
SITE_URL=http://localhost:3000

# Additional redirect URLs (comma-separated)
# Example: https://app.yourdomain.com,https://admin.yourdomain.com
ADDITIONAL_REDIRECT_URLS=

# JWT token expiry in seconds (default: 3600 = 1 hour)
JWT_EXPIRY=3600

# JWT algorithm (default: HS256)
JWT_ALGORITHM=HS256

# ============================================
# GOTRUE (AUTHENTICATION SERVICE) CONFIGURATION
# ============================================
# Disable signup (set to true to disable public signups)
GOTRUE_DISABLE_SIGNUP=false

# External URL for GoTrue
GOTRUE_SITE_URL=${SITE_URL}

# URI for GoTrue API
GOTRUE_URI=http://localhost:${GOTRUE_PORT}

# JWT settings
GOTRUE_JWT_SECRET=${JWT_SECRET}
GOTRUE_JWT_EXP=${JWT_EXPIRY}
GOTRUE_JWT_AUD=authenticated

# Database connection
GOTRUE_DB_DRIVER=postgres

# Email settings
GOTRUE_SMTP_HOST=${SMTP_HOST}
GOTRUE_SMTP_PORT=${SMTP_PORT}
GOTRUE_SMTP_USER=${SMTP_USER}
GOTRUE_SMTP_PASS=${SMTP_PASS}
GOTRUE_SMTP_ADMIN_EMAIL=${SMTP_ADMIN_EMAIL}

# Mailer autoconfirm (set to true to skip email confirmation in development)
GOTRUE_MAILER_AUTOCONFIRM=false

# External OAuth providers (optional)
# Uncomment and configure as needed
# GOTRUE_EXTERNAL_GOOGLE_ENABLED=false
# GOTRUE_EXTERNAL_GOOGLE_CLIENT_ID=
# GOTRUE_EXTERNAL_GOOGLE_SECRET=
# GOTRUE_EXTERNAL_GITHUB_ENABLED=false
# GOTRUE_EXTERNAL_GITHUB_CLIENT_ID=
# GOTRUE_EXTERNAL_GITHUB_SECRET=

# ============================================
# STORAGE CONFIGURATION
# ============================================
# Storage backend (s3 for MinIO)
STORAGE_BACKEND=s3

# S3/MinIO endpoint (internal Docker network)
STORAGE_S3_ENDPOINT=http://minio:9000

# Default storage bucket name
STORAGE_S3_BUCKET=supabase-storage

# S3 region (use 'local' for MinIO)
STORAGE_S3_REGION=local

# MinIO root credentials
# SECURITY: Use strong random passwords
# Generate with: openssl rand -base64 32
MINIO_ROOT_USER=minioadmin
MINIO_ROOT_PASSWORD=<strong-random-password>

# Storage file size limit (in bytes, default: 50MB)
STORAGE_FILE_SIZE_LIMIT=52428800

# ============================================
# EMAIL CONFIGURATION (SMTP)
# ============================================
# SMTP server for sending emails (auth, notifications, etc.)
# Examples: smtp.gmail.com, smtp.sendgrid.net, smtp.mailgun.org
SMTP_HOST=smtp.example.com

# SMTP port (587 for TLS, 465 for SSL, 25 for unencrypted)
SMTP_PORT=587

# SMTP username (usually your email address)
SMTP_USER=noreply@example.com

# SMTP password or API key
# SECURITY: Keep this secure
SMTP_PASS=<smtp-password>

# Admin email address (for system notifications)
SMTP_ADMIN_EMAIL=admin@example.com

# Sender name for emails
SMTP_SENDER_NAME=Supabase

# ============================================
# DOMAIN CONFIGURATION
# ============================================
# External URLs for accessing services
# These are used by clients to connect to your Supabase instance

# API Gateway external URL
# Local: http://localhost:8000
# Production: https://api.yourdomain.com
API_EXTERNAL_URL=http://localhost:8000

# Studio external URL
# Local: http://localhost:3000
# Production: https://studio.yourdomain.com
STUDIO_EXTERNAL_URL=http://localhost:3000

# Production domain names (used by Caddy for automatic HTTPS)
# Only required for production deployments
# Local development uses localhost and doesn't need these
API_DOMAIN=api.yourdomain.com
STUDIO_DOMAIN=studio.yourdomain.com

# Public REST API URL (via Kong)
PUBLIC_REST_URL=${API_EXTERNAL_URL}/rest/v1

# Public Realtime URL (via Kong)
PUBLIC_REALTIME_URL=${API_EXTERNAL_URL}/realtime/v1

# Public Storage URL (via Kong)
PUBLIC_STORAGE_URL=${API_EXTERNAL_URL}/storage/v1

# Public Auth URL (via Kong)
PUBLIC_AUTH_URL=${API_EXTERNAL_URL}/auth/v1

# ============================================
# POSTGREST CONFIGURATION
# ============================================
# PostgREST database URI
PGRST_DB_URI=postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@${POSTGRES_HOST}:5432/${POSTGRES_DB}

# Database schema to expose via REST API
PGRST_DB_SCHEMA=public,storage,graphql_public

# Extra search path for PostgreSQL
PGRST_DB_EXTRA_SEARCH_PATH=public,extensions

# Anonymous role for unauthenticated requests
PGRST_DB_ANON_ROLE=anon

# JWT secret for PostgREST
PGRST_JWT_SECRET=${JWT_SECRET}

# ============================================
# REALTIME CONFIGURATION
# ============================================
# Database connection for Realtime
REALTIME_DB_URL=postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@${POSTGRES_HOST}:5432/${POSTGRES_DB}

# JWT secret for Realtime
REALTIME_JWT_SECRET=${JWT_SECRET}

# Port for Realtime server
REALTIME_PORT=4000

# ============================================
# KONG CONFIGURATION
# ============================================
# Kong declarative config (will be generated)
KONG_DECLARATIVE_CONFIG=/var/lib/kong/kong.yml

# Kong database (off for declarative mode)
KONG_DATABASE=off

# DNS resolver (Docker internal DNS)
KONG_DNS_ORDER=LAST,A,CNAME

# Plugins
KONG_PLUGINS=request-transformer,cors,key-auth,acl,rate-limiting

# ============================================
# META API CONFIGURATION
# ============================================
# Database connection for Meta API
META_DB_URL=postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@${POSTGRES_HOST}:5432/${POSTGRES_DB}

# ============================================
# REDIS CONFIGURATION
# ============================================
# Redis host (internal Docker network)
REDIS_HOST=redis

# Redis port
REDIS_PORT=6379

# Redis password (optional, leave empty for no password)
REDIS_PASSWORD=

# ============================================
# CADDY CONFIGURATION
# ============================================
# Caddy admin API (internal only)
CADDY_ADMIN=localhost:2019

# Caddy HTTP port
CADDY_HTTP_PORT=80

# Caddy HTTPS port
CADDY_HTTPS_PORT=443

# ============================================
# LOGGING CONFIGURATION
# ============================================
# Log level: debug, info, warn, error
LOG_LEVEL=info

# Enable query logging (can be verbose)
ENABLE_QUERY_LOGGING=false

# ============================================
# RESOURCE LIMITS (Optional)
# ============================================
# Uncomment to set resource limits for containers
# Useful for production deployments

# PostgreSQL
# POSTGRES_MAX_CONNECTIONS=100
# POSTGRES_SHARED_BUFFERS=256MB
# POSTGRES_EFFECTIVE_CACHE_SIZE=1GB

# Kong
# KONG_MEM_CACHE_SIZE=128m
# KONG_NGINX_WORKER_PROCESSES=auto

# ============================================
# BACKUP CONFIGURATION (Optional)
# ============================================
# Backup retention (days)
BACKUP_RETENTION_DAYS=7

# Backup schedule (cron format)
BACKUP_SCHEDULE="0 2 * * *"

# Remote backup location (optional)
# BACKUP_REMOTE_URL=s3://your-bucket/backups

# ============================================
# DEVELOPMENT/DEBUG OPTIONS
# ============================================
# Enable debug mode (verbose logging)
DEBUG=false

# Enable SQL query logging
SQL_DEBUG=false

# Disable SSL verification (development only)
# NEVER use in production
DISABLE_SSL_VERIFICATION=false

# ============================================
# NOTES
# ============================================
# 1. After copying this file to .env, run: ./scripts/generate-secrets.sh
#    to generate secure values for JWT_SECRET, ANON_KEY, and SERVICE_ROLE_KEY
#
# 2. For multi-instance deployments, ensure PROJECT_NAME is unique for each instance
#
# 3. For production, update all domain URLs to use HTTPS and your actual domain
#
# 4. Never commit the actual .env file to version control
#
# 5. See docs/ENVIRONMENT_VARIABLES.md for detailed documentation